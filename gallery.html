<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Gallery</title>
    <link rel="stylesheet" href="style.css">
    <style>body, 
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Define size classes for random sizing */
        .size-small {
            grid-column: span 1;
            grid-row: span 1;
        }

        .size-medium {
            grid-column: span 2;
            grid-row: span 2;
        }
        .size-medium-h {
            grid-column: span 2;
            grid-row: span 1;
        }
        .size-medium-v {
            grid-column: span 1;
            grid-row: span 2;
        }

        .size-large {
            grid-column: span 3;
            grid-row: span 3;
        }
        .size-large-h {
            grid-column: span 3;
            grid-row: span 2;
        }
        .size-large-v {
            grid-column: span 2;
            grid-row: span 3;
        }

        .grid {
            width: 100%;
            height: 80vh;
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* Base number of columns is 5 */
            gap: 5px;
            margin-right:10%;
            box-sizing: border-box;
            grid-auto-flow: dense; /* Make sure items fill gaps */
        }

        .item {
            background: #f4f4f4;
            width: 100%;
            height: 100%;
            aspect-ratio: 1;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            background-size: cover;
            background-position: center;
            display: block; /* Ensure <a> tag is block-level */
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 600px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 400px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        .container{
            width: 95%;
        }
        </style>
</head>
<body>

<nav class="sidebar">
    <ul>
        <li><a href="index.html"><span class="underline">h</span>ome</a></li>
        <li><a href="#"><span class="underline">a</span>rtists</a></li>
        <li><a href="gallery.html"><span class="underline">p</span>ieces</a></li>
        <li><a href="#">about</a></li>
    </ul>
</nav>

<div class="content">
    <h1>Artwork Display</h1>
    <div class="subtitle">
        <h2>Works</h2>
    </div>
    <div class="container"> 
    <div id="output" class="grid"></div>
    </div>
    <script>
        fetch('data.json')
        .then(response => response.json()) // Parse the JSON data
        .then(jsonData => {
            // Step 2: Extract the list of items
            let items = jsonData.items;

            // Step 3: Randomize the order using the Fisher-Yates Shuffle
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]]; // Swap elements
                }
            }

            shuffleArray(items);

            // Step 4: Flatten the structure and randomize URLs within each item
            let flattenedItems = [];

            items.forEach(item => {
                shuffleArray(item.image_urls);  // Shuffle the image_urls array for each item

                item.image_urls.forEach((url, index) => {
                    flattenedItems.push({
                        url: url,
                        tweet_url: item.tweet_url
                    });
                });
            });

            // Shuffle the flattened list of URLs
            shuffleArray(flattenedItems);

            // Define size classes for random assignment
            const sizeClasses = {
                small: 'size-small',
                medium: ['size-medium', 'size-medium-h', 'size-medium-v'],
                large: ['size-large', 'size-large-h', 'size-large-v']
            };

            function getRandomSizeClass() {
                const rand = Math.random();
                if (rand < 0.1) {
                    // 10% chance for large
                    return sizeClasses.large;
                } else if (rand < 0.4) {
                    // 30% chance for medium
                    return sizeClasses.medium;
                } else {
                    // Default to small
                    return [sizeClasses.small];
                }
            }

            function getAspectRatioClass(width, height, sizeClass) {
                const aspectRatio = width / height;
                if (sizeClass.includes('size-medium') || sizeClass.includes('size-large')) {
                    if (aspectRatio < 0.67) {
                        return sizeClass.find(c => c.includes('v')); // Vertical
                    } else if (aspectRatio > 1.42) {
                        return sizeClass.find(c => c.includes('h')); // Horizontal
                    }
                }
                return sizeClass[0]; // Default size class if no variation
            }

            // Load image dimensions and apply size classes
            const outputDiv = document.getElementById('output');
            let itemsLoaded = 0;

            flattenedItems.forEach(entry => {
                const img = new Image();
                img.src = entry.url;
                img.onload = () => {
                    const { width, height } = img;
                    const baseClasses = getRandomSizeClass();
                    const finalClass = getAspectRatioClass(width, height, baseClasses);

                    // Create the a tag
                    const link = document.createElement('a');
                    link.href = entry.tweet_url;
                    link.target = "_blank"; // Opens link in a new tab
                    link.className = 'item ' + finalClass; // Add final size class
                    link.style.backgroundImage = `url('${entry.url}')`;

                    // Append the a tag to the output div
                    outputDiv.appendChild(link);

                    itemsLoaded++;
                    if (itemsLoaded === flattenedItems.length) {
                        console.log('All images processed and added to the grid.');
                    }
                };
            });
        });
    </script> 

</body>
</html>
